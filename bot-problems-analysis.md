
# ü§ñ –ö—Ä–∏–ø—Ç–æ–±–æ—Ç - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

## üî¥ –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
**Callback-–∫–Ω–æ–ø–∫–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è** - –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
```
Update id=212159511 is not handled. Duration 5 ms
```
–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å", –±–æ—Ç –µ—ë –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

## üìä –°—Ç–∞—Ç—É—Å —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è (`@Cryptobotrapira_bot`)
- API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Rapira —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ª—É—á–∞–µ—Ç 16 –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç)
- HTTP –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ (`GET https://api.rapira.net/open/market/rates HTTP/1.1 200`)
- –ö–æ–º–∞–Ω–¥–∞ `/calc` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞–ª—é—Ç–Ω—ã–µ –ø–∞—Ä—ã
- –í—ã–±–æ—Ä –≤–∞–ª—é—Ç–Ω–æ–π –ø–∞—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—É—Ä—Å –∏ –∫–Ω–æ–ø–∫—É "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
- –í—Å–µ —Ä–æ—É—Ç–µ—Ä—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
  - ‚úÖ Basic handlers router registered
  - ‚úÖ Rate handler router registered
  - ‚úÖ Calc handler router registered
  - ‚úÖ Admin handler router registered

### ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **–ö–Ω–æ–ø–∫–∞ "üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å" –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–≤–æ–¥—É —Å—É–º–º—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞
- FSM –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ —Å—É–º–º—ã
- Callback query –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- API –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- –í—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞:
  - üìã Environment: development
  - üîß Debug mode: True
  - üí± Supported pairs: 8
  - üë• Admin users: 1

### üéØ –ì–¥–µ –ø—Ä–æ–±–ª–µ–º–∞:
**–†–æ—É—Ç–∏–Ω–≥ callback-–∑–∞–ø—Ä–æ—Å–æ–≤** - callback_query —Å –¥–∞–Ω–Ω—ã–º–∏ `start_calculation` –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `calc_handler.py`.

### üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```
Update id=212159509 is handled. Duration 973 ms   ‚úÖ
Update id=212159510 is handled. Duration 814 ms   ‚úÖ
Update id=212159511 is not handled. Duration 5 ms ‚ùå <- –ü–†–û–ë–õ–ï–ú–ê
Update id=212159512 is handled. Duration 540 ms   ‚úÖ
Update id=212159513 is handled. Duration 685 ms   ‚úÖ
Update id=212159514 is handled. Duration 205 ms   ‚úÖ
```

## ‚ö†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
```
Active currency pairs without assigned managers:
USDT/RUB, BTC/USDT, ETH/USDT, ETH/BTC, LTC/USDT, SOL/USDT, TON/USDT, DOGE/USDT
```

### –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
```
‚ö†Ô∏è Failed to initialize statistics service:
CacheServiceFactory.create_cache_service() missing 1 required positional argument: 'cache_config'
üìä Statistics features will be disabled
```

## üéØ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞

### üö® –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–∫—Ä–∏—Ç–∏—á–Ω–æ):
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** –≤ `src/bot/handlers/calc_handler.py`
2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
3. **–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å callback_data** –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

### üîß –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –¥–ª—è –≤–∞–ª—é—Ç–Ω—ã—Ö –ø–∞—Ä
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Ä–≤–∏—Å–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–¥–æ–±–∞–≤–∏—Ç—å `cache_config`)
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## üìã –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `src/bot/handlers/calc_handler.py` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `src/bot/states/calc_states.py` - FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `src/bot/keyboards/currency_keyboard.py` - –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- `main.py` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `src/config/settings.py` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
- `envtest.md` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `src/services/rapira_client.py` - API –∫–ª–∏–µ–Ω—Ç

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π callback_data** –≤ –∫–Ω–æ–ø–∫–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä** —É –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è** FSM
4. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** - –¥—Ä—É–≥–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç callback
5. **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π** callback_query –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
2. –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
3. –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```

–§–∞–π–ª `bot-problems-analysis.md` —Å–æ–∑–¥–∞–Ω –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º –±–æ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown.
